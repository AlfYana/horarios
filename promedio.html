<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promedio</title>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Anterior</th>
                <th>Posterior</th>
            </tr>
        </thead>
        <tbody id="promedio"></tbody>
    </table>
</body>
<script>
    let tabla = document.getElementById("promedio");
    const FECHAS = ["anterior", "posterior"];
    let urlAnterior = `./server/${FECHAS[0]}.json`;
    let urlPosterior = `./server/${FECHAS[1]}.json`;
    window.onload = actualizarDatos();
    function actualizarDatos() {
        let tbody = document.getElementById("promedio");
        tbody.innerHTML = "";
        actualizarTabla( {url: urlPosterior, dom: tbody, column: 3} );
        actualizarTabla( {url: urlAnterior, dom: tbody, column: 2} );
    }

    function actualizarTabla( params ) {
        //llamando al servidor para obtener los datos de la ruta del archivo json creado anteriormente
        fetch(params.url)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                let nodo = params.dom;
                let columna = params.column;
                let fecha = data.fecha;
                nodo.closest("table").querySelector("thead tr").querySelector(`td:nth-child(${columna})`).innerHTML = fecha;
                data.datos.forEach(item => {
                    let tr = getFilaPorNombre(item.nombre, nodo);
                    if(tr){
                        tr.querySelector(`td:nth-child(${columna})`).innerHTML = item.promedio;
                    }
                    else{
                        celdaAnterior =
                        nodo.appendChild( creaFila(item, columna));
                    }
                });
            })
            .catch( err => console.error(err));
    }
    /*****    busca por defecto en la primera fila    *******/
    function getFilaPorNombre(nombre, tbody){
        let tr = false;
        tbody.querySelectorAll('tr').forEach(fila => {
          if(fila.querySelector('td:first-child').dataset.nombre == nombre)
            tr = fila;
        });
        return tr;
    }

    function creaFila(fila, columna){
        let nuevaFila = document.createElement('tr');
        //console.log(nombre.replace(/([A-Z])/g, ' $1'));
        nuevaFila.innerHTML = `
          <td class="nombreOrk" data-nombre="${fila.nombre}">${fila.nombre.replace(/([A-Z])/g, ' $1')}</td>
          <td class=""></td>
          <td class=""></td>
        `;
        nuevaFila.querySelector(`td:nth-child(${columna})`).innerHTML = fila.promedio;
        return nuevaFila;
      }
</script>
</html>